<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>SISLAB - Inventário de Materiais</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            background-color: #E0E6EE;
        }

        .main-header-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            gap: 15px;
            flex-wrap: wrap;
        }

        h1 {
            color: #1A2B4C;
            margin: 0;
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            padding: 5px 15px;
            border-bottom: 3px solid #007BFF; /* Cor diferente para inventário */
            display: inline-block;
            letter-spacing: 1.5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            white-space: nowrap;
        }
        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
                padding: 5px 10px;
            }
            .main-header-container {
                flex-direction: column;
                gap: 5px;
            }
        }

        .main-content-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            width: 95%;
            max-width: 1400px; /* Aumenta a largura para comportar mais conteúdo */
            margin-bottom: 20px;
        }

        .column {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            box-sizing: border-box;
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
        }

        .column.wide {
            flex-basis: calc(66.66% - 10px); /* Para a coluna da lista de itens */
        }
        .column.narrow {
            flex-basis: calc(33.33% - 10px); /* Para a coluna de cadastro/movimentação */
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;
            gap: 20px;
            margin-bottom: 15px;
            width: 100%;
        }

        .form-field {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            flex-basis: 0;
            min-width: 150px;
        }

        .form-field.full-width {
            flex-basis: 100%;
        }

        .form-field label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #334466;
        }

        .form-field input[type="text"],
        .form-field input[type="number"],
        .form-field input[type="date"],
        .form-field select,
        .form-field textarea {
            padding: 10px;
            border: 1px solid #AABBDD;
            border-radius: 4px;
            font-size: 1em;
            width: 100%;
            box-sizing: border-box;
        }

        .action-buttons-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            width: 95%;
            max-width: 1400px;
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            box-sizing: border-box;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background-color: #1A2B4C;
            color: white;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #0F1D33;
        }

        button.highlight-button {
            background-color: #007BFF; /* Azul para destaque */
            font-weight: bold;
            padding: 12px 25px;
        }

        button.highlight-button:hover {
            background-color: #0056b3;
        }

        /* Tabela de Inventário */
        #inventarioTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        #inventarioTable th, #inventarioTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        #inventarioTable th {
            background-color: #f2f2f2;
            color: #333;
            cursor: pointer;
        }
        #inventarioTable tr:nth-child(even){background-color: #f9f9f9;}
        #inventarioTable tr:hover {background-color: #f1f1f1;}

        .alert-item {
            background-color: #ffcccc;
            border: 1px solid #ff0000;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }

        @media (max-width: 900px) {
            .main-content-container {
                flex-direction: column;
                width: 95%;
            }
            .column.wide, .column.narrow {
                flex-basis: 100%;
                min-width: unset;
            }
        }
    </style>
</head>
<body>
    <div class="main-header-container">
        <h1 class="main-title">Inventário de Materiais - SISLAB</h1>
    </div>

    <div class="main-content-container">
        <div class="column narrow">
            <h3>Cadastro/Edição de Item:</h3>
            <div class="form-row">
                <input type="hidden" id="itemId">
                <div class="form-field full-width">
                    <label for="nomeItem">Nome do Item:</label>
                    <input type="text" id="nomeItem" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label for="categoria">Categoria:</label>
                    <input type="text" list="categoriasSugeridas" id="categoria">
                    <datalist id="categoriasSugeridas">
                        <option value="Materiais Consumíveis">
                        <option value="Reagentes">
                        <option value="Equipamentos">
                    </datalist>
                </div>
                <div class="form-field">
                    <label for="unidadeMedida">Unidade de Medida:</label>
                    <input type="text" id="unidadeMedida" placeholder="unidades, caixas, ml">
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label for="localizacao">Localização:</label>
                    <input type="text" id="localizacao">
                </div>
                <div class="form-field">
                    <label for="dataValidade">Data de Validade:</label>
                    <input type="date" id="dataValidade">
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label for="limiteMinimo">Limite Mínimo:</label>
                    <input type="number" id="limiteMinimo" min="0" value="0">
                </div>
                <div class="form-field">
                    <label for="fornecedor">Fornecedor:</label>
                    <input type="text" id="fornecedor">
                </div>
            </div>
            <div class="form-row">
                <div class="form-field full-width">
                    <label for="observacoesItem">Observações do Item:</label>
                    <textarea id="observacoesItem" rows="2"></textarea>
                </div>
            </div>
            <div class="form-row">
                <button onclick="salvarItemInventario()" class="highlight-button">Salvar/Atualizar Item</button>
                <button onclick="limparFormularioItem()">Novo Item</button>
            </div>

            <hr style="margin: 25px 0;">

            <h3>Movimentação de Estoque:</h3>
            <div class="form-row">
                <div class="form-field full-width">
                    <label for="itemMovimento">Item para Movimentar:</label>
                    <input type="text" id="itemMovimento" placeholder="Pesquise o item aqui..." list="itensDisponiveis">
                    <datalist id="itensDisponiveis"></datalist>
                    <input type="hidden" id="itemMovimentoId">
                    <p style="font-size: 0.9em; color: #555;">Quantidade Atual: <span id="quantidadeAtualDisplay">--</span></p>
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label for="tipoMovimento">Tipo de Movimento:</label>
                    <select id="tipoMovimento">
                        <option value="Entrada">Entrada</option>
                        <option value="Saida">Saída</option>
                    </select>
                </div>
                <div class="form-field">
                    <label for="quantidadeMovimento">Quantidade:</label>
                    <input type="number" id="quantidadeMovimento" min="1" value="1">
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label for="responsavelMovimento">Responsável:</label>
                    <input type="text" id="responsavelMovimento" placeholder="Seu nome">
                </div>
                <div class="form-field">
                    <label for="motivoMovimento">Motivo:</label>
                    <textarea id="motivoMovimento" rows="1"></textarea>
                </div>
            </div>
            <div class="form-row">
                <button onclick="registrarMovimentoEstoque()" class="highlight-button">Registrar Movimento</button>
            </div>
        </div>

        <div class="column wide">
            <h3>Itens do Inventário:</h3>
            <div class="form-row">
                <div class="form-field full-width">
                    <label for="pesquisaInventario">Pesquisar Itens:</label>
                    <input type="text" id="pesquisaInventario" placeholder="Pesquisar por nome, categoria, localização...">
                </div>
            </div>
            <div id="alertasEstoqueBaixo" style="margin-top: 10px;">
                <h4>Alertas de Estoque Baixo:</h4>
                <p>Nenhum alerta no momento.</p>
            </div>
            <table id="inventarioTable">
                <thead>
                    <tr>
                        <th data-sort="nome">Nome do Item</th>
                        <th data-sort="categoria">Categoria</th>
                        <th data-sort="quantidadeAtual">Qtd. Atual</th>
                        <th data-sort="unidadeMedida">Unidade</th>
                        <th data-sort="dataValidade">Validade</th>
                        <th data-sort="limiteMinimo">Limite Mínimo</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="inventarioTableBody">
                    <tr><td colspan="7">Carregando itens...</td></tr>
                </tbody>
            </table>
            </div>
    </div>

    <div class="action-buttons-container">
        <button onclick="gerarRelatorioInventarioPDF()">Gerar Relatório de Inventário (PDF)</button>
        <button onclick="window.location.href='log_inventario.html'">Ver Log de Movimentações</button>
        <button onclick="window.location.href='index.html'">Voltar para Cadastro de Exames</button>
        <button onclick="window.location.href='admin.html'">Acessar Admin</button>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        // Importar TODOS os módulos do Firestore que serão usados
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit, deleteDoc, doc, writeBatch, where, serverTimestamp, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA_LEim5s-_NSCk3ySVCcUzDjIq0RPlvnA",
            authDomain: "sislab-cetep.firebaseapp.com",
            projectId: "sislab-cetep",
            storageBucket: "sislab-cetep.firebasestorage.app",
            messagingSenderId: "958611861664",
            appId: "1:958611861664:web:97a3755f2b1958b0c8d9c5",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- Torna as instâncias e funções do Firebase acessíveis globalmente ---
        window.firebaseApp = app;
        window.firestoreDb = db;

        // Funções do Firestore para usar no inventario_scripts.js
        window.firebaseFirestoreCollection = collection;
        window.firebaseFirestoreAddDoc = addDoc;
        window.firebaseFirestoreGetDocs = getDocs;
        window.firebaseFirestoreQuery = query;
        window.firebaseFirestoreOrderBy = orderBy;
        window.firebaseFirestoreLimit = limit;
        window.firebaseFirestoreDeleteDoc = deleteDoc;
        window.firebaseFirestoreDoc = doc;
        window.firebaseFirestoreWriteBatch = writeBatch;
        window.firebaseFirestoreWhere = where;
        window.firebaseFirestoreServerTimestamp = serverTimestamp;
        window.firebaseFirestoreGetDoc = getDoc;
        window.firebaseFirestoreUpdateDoc = updateDoc; // Adicionado para updateDoc

    </script>
    <script src="inventario_scripts.js"></script>
</body>
</html>
